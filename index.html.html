<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø´Ø±ÙƒØ© Mohamed Attia Ù„Ù„Ù†Ø¸Ø§ÙØ©</title>
<style>
body{font-family:Arial;text-align:center;background:#f8f9fa;margin:0;padding:0;}
header{background:#0d6efd;color:white;padding:15px;font-size:20px;}
.login,.main{max-width:400px;margin:auto;background:white;padding:20px;border-radius:10px;box-shadow:0 0 10px #ccc;margin-top:40px;}
input,button{width:100%;padding:10px;margin:5px 0;border:1px solid #ccc;border-radius:8px;font-size:16px;}
button{background:#0d6efd;color:white;border:none;cursor:pointer;}
button:hover{background:#0b5ed7;}
table{width:100%;border-collapse:collapse;margin-top:10px;}
th,td{border:1px solid #ccc;padding:8px;text-align:center;}
th{background:#e9ecef;}
.delete-btn{cursor:pointer;color:red;font-size:18px;}
.lang{position:fixed;bottom:5px;left:5px;font-size:14px;}
footer{margin-top:30px;font-size:14px;color:gray;}
.logout-btn{background:#c0392b;margin-top:10px;}
@media(max-width:600px){.login,.main{margin-top:20px;}}
</style>
</head>
<body>

<header>Ø´Ø±ÙƒØ© Mohamed Attia Ù„Ù„Ù†Ø¸Ø§ÙØ©</header>

<div class="login" id="loginDiv">
<h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
<input id="username" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
<input id="password" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
<button id="loginBtn">Ø¯Ø®ÙˆÙ„</button>
</div>

<div class="main" id="mainDiv" style="display:none;">
<h3 id="welcome"></h3>
<div id="shiftForm">
<input id="shiftDate" type="date">
<input id="shiftLocation" placeholder="Ø§Ù„Ù…ÙƒØ§Ù†">
<input id="shiftCount" type="number" min="1" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ø´ÙØªØ§Øª">
<input id="shiftTotal" type="number" min="0" placeholder="Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ">
<button id="addShiftBtn">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø´ÙØª</button>
<button id="exportBtn">ğŸ“Š ØªØµØ¯ÙŠØ± Excel</button>
</div>

<table id="shiftTable">
<thead><tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ù…ÙƒØ§Ù†</th><th>Ø¹Ø¯Ø¯ Ø§Ù„Ø´ÙØªØ§Øª</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th><th>ğŸ—‘ï¸</th></tr></thead>
<tbody id="shiftBody"></tbody>
</table>

<h4 id="grandTotal"></h4>
<button class="logout-btn" id="logoutBtn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>

<footer>Made by Ahmed</footer>

<div class="lang">
ğŸŒ <select id="langSelect">
<option value="ar">Ø¹Ø±Ø¨ÙŠ</option>
<option value="en">English</option>
</select>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script>
// Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
const users={m1:"1234",m2:"5678",admin:"admin"};
let lang="ar";

// Ø§Ù„Ø¯ÙˆØ§Ù„
function showMainPage(){
  document.getElementById("loginDiv").style.display="none";
  document.getElementById("mainDiv").style.display="block";
  const user=localStorage.getItem("loggedUser");
  document.getElementById("welcome").textContent=user==="admin"?"Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ Ø§Ù„Ù…Ø¯ÙŠØ±":"Ù…Ø±Ø­Ø¨Ù‹Ø§ "+user;
  showShifts();
}

function login(){
  const u=document.getElementById("username").value.trim();
  const p=document.getElementById("password").value.trim();
  if(users[u] && users[u]===p){
    localStorage.setItem("loggedUser",u);
    showMainPage();
  }else alert("Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
}

function logout(){
  localStorage.removeItem("loggedUser");
  document.getElementById("mainDiv").style.display="none";
  document.getElementById("loginDiv").style.display="block";
}

function addShift(){
  const user=localStorage.getItem("loggedUser");
  const d=document.getElementById("shiftDate").value;
  const l=document.getElementById("shiftLocation").value;
  const c=document.getElementById("shiftCount").value;
  const t=document.getElementById("shiftTotal").value;
  if(!d||!l||!c||!t){alert("Ø§Ù…Ù„Ø£ ÙƒÙ„ Ø§Ù„Ø®Ø§Ù†Ø§Øª");return;}
  const newShift={date:d,loc:l,shifts:c,total:t};
  let arr=JSON.parse(localStorage.getItem("shifts_"+user)||"[]");
  arr.push(newShift);
  localStorage.setItem("shifts_"+user,JSON.stringify(arr));
  showShifts();
  // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ©
  document.getElementById("shiftDate").value="";
  document.getElementById("shiftLocation").value="";
  document.getElementById("shiftCount").value="";
  document.getElementById("shiftTotal").value="";
}

function showShifts(){
  const user=localStorage.getItem("loggedUser");
  const tbody=document.getElementById("shiftBody");
  tbody.innerHTML="";
  let data=[];
  if(user==="admin"){
    Object.keys(users).forEach(u=>{
      if(u!=="admin"){let d=JSON.parse(localStorage.getItem("shifts_"+u)||"[]");d.forEach(r=>data.push({...r,user:u}));}
    });
  } else data=JSON.parse(localStorage.getItem("shifts_"+user)||"[]");

  data.forEach((r,i)=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${r.date}</td><td>${r.loc}</td><td>${r.shifts}</td><td>${r.total}</td>
    <td><span class="delete-btn" onclick="deleteShift(${i},'${r.user||user}')">ğŸ—‘ï¸</span></td>`;
    tbody.appendChild(tr);
  });
  document.getElementById("grandTotal").textContent=
    lang==="ar"?`Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ: ${computeTotal()}`:`Grand Total: ${computeTotal()}`;
}

function deleteShift(index,user){
  let arr=JSON.parse(localStorage.getItem("shifts_"+user)||"[]");
  arr.splice(index,1);
  localStorage.setItem("shifts_"+user,JSON.stringify(arr));
  showShifts();
}

function computeTotal(){
  const user=localStorage.getItem("loggedUser");
  let allTotals=[];
  if(user==="admin"){
    Object.keys(users).forEach(u=>{
      if(u!=="admin"){let d=JSON.parse(localStorage.getItem("shifts_"+u)||"[]");allTotals.push(...d.map(r=>Number(r.total)));}
    });
  } else{
    const d=JSON.parse(localStorage.getItem("shifts_"+user)||"[]");
    allTotals=d.map(r=>Number(r.total));
  }
  return allTotals.reduce((a,b)=>a+b,0);
}

function exportExcel(){
  const user=localStorage.getItem("loggedUser");
  let data=[];
  if(user==="admin"){
    Object.keys(users).forEach(u=>{
      if(u!=="admin"){let d=JSON.parse(localStorage.getItem("shifts_"+u)||"[]");d.forEach(r=>data.push({User:u,Date:r.date,Location:r.loc,Shifts:r.shifts,Total:r.total}));}
    });
  } else{
    let d=JSON.parse(localStorage.getItem("shifts_"+user)||"[]");
    d.forEach(r=>data.push({Date:r.date,Location:r.loc,Shifts:r.shifts,Total:r.total}));
  }
  const ws=XLSX.utils.json_to_sheet(data);
  const wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,ws,"Shifts");
  XLSX.writeFile(wb,user==="admin"?"shifts_MohamedAttia.xlsx":`shifts_${user}.xlsx`);
}

function toggleLang(){
  lang=document.getElementById("langSelect").value;
  document.dir=lang==="ar"?"rtl":"ltr";
  showShifts();
}

// Ø¥Ø¶Ø§ÙØ© Ø£Ø­Ø¯Ø§Ø« Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
window.onload=function(){
  const user=localStorage.getItem("loggedUser");
  if(user) showMainPage();
  document.getElementById("loginBtn").addEventListener("click",login);
  document.getElementById("addShiftBtn").addEventListener("click",addShift);
  document.getElementById("exportBtn").addEventListener("click",exportExcel);
  document.getElementById("logoutBtn").addEventListener("click",logout);
  document.getElementById("langSelect").addEventListener("change",toggleLang);
};
</script>

</body>
</html>
